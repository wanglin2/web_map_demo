(function(t){function e(e){for(var n,s,a=e[0],h=e[1],c=e[2],l=0,d=[];l<a.length;l++)s=a[l],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(n in h)Object.prototype.hasOwnProperty.call(h,n)&&(t[n]=h[n]);u&&u(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),o()}function o(){for(var t,e=0;e<r.length;e++){for(var o=r[e],n=!0,a=1;a<o.length;a++){var h=o[a];0!==i[h]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=o[0]))}return t}var n={},i={app:0},r=[];function s(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=n,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(o,n,function(e){return t[e]}.bind(null,n));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],h=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var u=h;r.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"56d7":function(t,e,o){"use strict";o.r(e);o("e260"),o("e6cf"),o("cca6"),o("a79d");var n=o("7a23"),i={class:"map",ref:"map"},r={class:"center"},s=Object(n["c"])("div",{class:"line lineX"},null,-1),a=Object(n["c"])("div",{class:"line lineY"},null,-1);function h(t,e,o,h,c,u){return Object(n["d"])(),Object(n["b"])("div",i,[Object(n["c"])("canvas",{ref:"canvas",onMousedown:e[0]||(e[0]=function(){return u.onMousedown&&u.onMousedown.apply(u,arguments)})},null,544),Object(n["c"])("div",r,Object(n["e"])(this.center[0]+","+this.center[1]),1),s,a],512)}for(var c=o("d4ec"),u=o("bee2"),l=o("2909"),d=o("3835"),f=(o("99af"),o("d81d"),o("d3b7"),o("159b"),o("b64b"),o("3623")),p=function(t){return t*(Math.PI/180)},m=function(t){return t*(180/Math.PI)},v=6378137,b=function(t,e){var o=p(t)*v,n=p(e),i=Math.sin(n),r=v/2*Math.log((1+i)/(1-i));return[o,r]},w=function(t,e){var o=m(t)/v,n=m(2*Math.atan(Math.exp(e/v))-Math.PI/2);return[o,n]},y=2*Math.PI*v,M=256,g=function(t){var e=Math.pow(2,t),o=e*M;return y/o},C=[],O=0;O<=18;O++)C.push(g(O));var j=function(t,e){return t+=y/2,e=y/2-e,[t,e]},x=function(t,e,o){var n=j(t,e);t=n[0],e=n[1];var i=C[o],r=Math.floor(t/i/M),s=Math.floor(e/i/M);return[r,s]},z=function(t,e,o){var n=j.apply(void 0,Object(l["a"])(b(t,e))),i=Object(d["a"])(n,2),r=i[0],s=i[1],a=C[o],h=Math.floor(r/a),c=Math.floor(s/a);return[h,c]},T=function(t,e,o){var n=[1,2,3,4],i=n[Math.floor(Math.random()*n.length)];return"https://webrd0".concat(i,".is.autonavi.com/appmaptile?x=").concat(t,"&y=").concat(e,"&z=").concat(o,"&lang=zh_cn&size=1&scale=1&style=8")},P=function(){function t(e){var o=e.ctx,n=e.row,i=e.col,r=e.zoom,s=e.x,a=e.y,h=e.shouldRender;Object(c["a"])(this,t),this.ctx=o,this.row=n,this.col=i,this.zoom=r,this.x=s,this.y=a,this.shouldRender=h,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.loaded=!1,this.timer=null,this.createUrl(),this.load()}return Object(u["a"])(t,[{key:"createUrl",value:function(){this.url=T(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this;this.img=new Image,this.img.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),this.img.onload=function(){clearTimeout(t.timer),t.loaded=!0,t.render()}}},{key:"render",value:function(){this.loaded&&this.shouldRender(this.cacheKey)&&this.ctx.drawImage(this.img,this.x,this.y)}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),k={name:"App",data:function(){return{width:0,height:0,rowCount:0,colCount:0,halfRowCount:0,halfColCount:0,isMousedown:!1,tileCache:{},currentTileCache:{},center:[120.148732,30.231006],zoom:17,minZoom:3,maxZoom:18,ctx:null,lastZoom:0,scale:1,scaleTmp:1,playback:null}},mounted:function(){this.initCanvas(),this.getCount(),this.renderTiles(),window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup),window.addEventListener("wheel",this.onMousewheel)},methods:{initCanvas:function(){var t=this.$refs.map.getBoundingClientRect(),e=t.width,o=t.height;this.width=e,this.height=o;var n=this.$refs.canvas;n.width=this.width,n.height=this.height,this.ctx=n.getContext("2d"),this.ctx.translate(this.width/2,this.height/2)},getCount:function(){var t=2;this.rowCount=Math.ceil(this.width/M)+t,this.colCount=Math.ceil(this.height/M)+t,this.halfRowCount=Math.ceil(this.rowCount/2),this.halfColCount=Math.ceil(this.colCount/2)},renderTiles:function(){var t=this,e=x.apply(void 0,Object(l["a"])(b.apply(void 0,Object(l["a"])(this.center))).concat([this.zoom])),o=[e[0]*M,e[1]*M],n=z.apply(void 0,Object(l["a"])(this.center).concat([this.zoom])),i=[o[0]-n[0],o[1]-n[1]],r=[this.halfRowCount,this.halfColCount];this.currentTileCache={};for(var s=0;s<this.rowCount;s++)for(var a=0;a<this.colCount;a++){var h=[r[0]-s,r[1]-a],c=e[0]+h[0],u=e[1]+h[1],d=i[0]+h[0]*M,f=i[1]+h[1]*M,p=c+"_"+u+"_"+this.zoom;this.currentTileCache[p]=!0,this.tileCache[p]?this.tileCache[p].updatePos(d,f).render():this.tileCache[p]=new P({ctx:this.ctx,row:c,col:u,zoom:this.zoom,x:d,y:f,shouldRender:function(e){return t.currentTileCache[e]}})}},clear:function(){this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=t.movementX*C[this.zoom],o=t.movementY*C[this.zoom],n=b.apply(void 0,Object(l["a"])(this.center)),i=Object(d["a"])(n,2),r=i[0],s=i[1];this.center=w(r-e,o+s),this.clear(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1},onMousewheel:function(t){var e=this;t.deltaY>0?this.zoom>this.minZoom&&this.zoom--:this.zoom<this.maxZoom&&this.zoom++,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=t.deltaY>0?.5:2,this.playback&&this.playback.stop(),this.playback=Object(f["a"])({from:this.scaleTmp,to:this.scale,onUpdate:function(t){e.scaleTmp=t,e.ctx.save(),e.clear(),e.ctx.scale(t,t),Object.keys(e.currentTileCache).forEach((function(t){e.tileCache[t].render()})),e.ctx.restore()},onComplete:function(){e.scale=1,e.scaleTmp=1,e.renderTiles()}}))}}},_=(o("b81b"),o("6b0d")),R=o.n(_);const Z=R()(k,[["render",h]]);var I=Z;Object(n["a"])(I).mount("#app")},"9bca":function(t,e,o){},b81b:function(t,e,o){"use strict";o("9bca")}});
//# sourceMappingURL=app.dd54828f.js.map