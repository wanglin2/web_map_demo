(function(t){function e(e){for(var o,a,r=e[0],h=e[1],c=e[2],l=0,d=[];l<r.length;l++)a=r[l],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&d.push(n[a][0]),n[a]=0;for(o in h)Object.prototype.hasOwnProperty.call(h,o)&&(t[o]=h[o]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],o=!0,r=1;r<i.length;r++){var h=i[r];0!==n[h]&&(o=!1)}o&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var o={},n={app:0},s=[];function a(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=o,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(i,o,function(e){return t[e]}.bind(null,o));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="dist/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],h=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=h;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},2031:function(t,e,i){},5649:function(t,e,i){"use strict";i("2031")},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var o=i("7a23"),n={class:"app"},s={class:"mapContainer"},a={class:"btnGroup"};function r(t,e,i,r,h,c){var u=this;return Object(o["f"])(),Object(o["c"])("div",n,[Object(o["d"])("div",s,[(Object(o["f"])(),Object(o["b"])(Object(o["i"])(h.comp)))]),Object(o["d"])("div",a,[Object(o["d"])("div",{class:Object(o["e"])(["btn",{active:"New"===this.comp}]),onClick:e[0]||(e[0]=function(t){return u.comp="New"})},"优化版",2),Object(o["d"])("div",{class:Object(o["e"])(["btn",{active:"Old"===this.comp}]),onClick:e[1]||(e[1]=function(t){return u.comp="Old"})},"原始版",2)])])}var h=function(t){return Object(o["h"])("data-v-28d4dc86"),t=t(),Object(o["g"])(),t},c={class:"map",ref:"map"},u={class:"center"},l=h((function(){return Object(o["d"])("div",{class:"line lineX"},null,-1)})),d=h((function(){return Object(o["d"])("div",{class:"line lineY"},null,-1)}));function m(t,e,i,n,s,a){return Object(o["f"])(),Object(o["c"])("div",c,[Object(o["d"])("canvas",{ref:"canvas",onMousedown:e[0]||(e[0]=function(){return a.onMousedown&&a.onMousedown.apply(a,arguments)})},null,544),Object(o["d"])("div",u,Object(o["j"])(this.center[0]+","+this.center[1]),1),l,d],512)}for(var f=i("3835"),p=i("2909"),v=i("d4ec"),w=i("bee2"),y=(i("d81d"),i("99af"),i("d3b7"),i("159b"),i("b64b"),i("3623")),b=function(t){return t*(Math.PI/180)},C=function(t){return t*(180/Math.PI)},g=6378137,O=function(t,e){var i=b(t)*g,o=b(e),n=Math.sin(o),s=g/2*Math.log((1+n)/(1-n));return[i,s]},M=function(t,e){var i=C(t)/g,o=C(2*Math.atan(Math.exp(e/g))-Math.PI/2);return[i,o]},j=2*Math.PI*g,x=256,z=function(t){var e=Math.pow(2,t),i=e*x;return j/i},T=[],L=0;L<=18;L++)T.push(z(L));var k=function(t,e){return t+=j/2,e=j/2-e,[t,e]},_=function(t,e,i){var o=k(t,e);t=o[0],e=o[1];var n=T[i],s=Math.floor(t/n/x),a=Math.floor(e/n/x);return[s,a]},I=function(t,e,i){var o=k.apply(void 0,Object(p["a"])(O(t,e))),n=Object(f["a"])(o,2),s=n[0],a=n[1],r=T[i],h=Math.floor(s/r),c=Math.floor(a/r);return[h,c]},R=function(t,e,i){var o=[1,2,3,4],n=o[Math.floor(Math.random()*o.length)];return"https://webrd0".concat(n,".is.autonavi.com/appmaptile?x=").concat(t,"&y=").concat(e,"&z=").concat(i,"&lang=zh_cn&size=1&scale=1&style=8")},P=function(){function t(e){var i=e.ctx,o=e.row,n=e.col,s=e.zoom,a=e.x,r=e.y,h=e.shouldRender;Object(v["a"])(this,t),this.ctx=i,this.row=o,this.col=n,this.zoom=s,this.x=a,this.y=r,this.shouldRender=h,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.loaded=!1,this.timer=null,this.createUrl(),this.load()}return Object(w["a"])(t,[{key:"createUrl",value:function(){this.url=R(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this;this.img=new Image,this.img.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),this.img.onload=function(){clearTimeout(t.timer),t.loaded=!0,t.render()}}},{key:"render",value:function(){this.loaded&&this.shouldRender(this.cacheKey)&&this.ctx.drawImage(this.img,this.x,this.y)}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),Z={name:"App",data:function(){return{width:0,height:0,rowCount:0,colCount:0,halfRowCount:0,halfColCount:0,isMousedown:!1,tileCache:{},currentTileCache:{},center:[120.148732,30.231006],zoom:17,minZoom:3,maxZoom:18,ctx:null,lastZoom:0,scale:1,scaleTmp:1,playback:null}},mounted:function(){this.initCanvas(),this.getCount(),this.renderTiles(),window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup),window.addEventListener("wheel",this.onMousewheel)},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup),window.removeEventListener("wheel",this.onMousewheel)},methods:{initCanvas:function(){var t=this.$refs.map.getBoundingClientRect(),e=t.width,i=t.height;this.width=e,this.height=i;var o=this.$refs.canvas;o.width=this.width,o.height=this.height,this.ctx=o.getContext("2d"),this.ctx.translate(this.width/2,this.height/2)},getCount:function(){var t=2;this.rowCount=Math.ceil(this.width/x)+t,this.colCount=Math.ceil(this.height/x)+t,this.halfRowCount=Math.ceil(this.rowCount/2),this.halfColCount=Math.ceil(this.colCount/2)},renderTiles:function(){var t=this,e=_.apply(void 0,Object(p["a"])(O.apply(void 0,Object(p["a"])(this.center))).concat([this.zoom])),i=[e[0]*x,e[1]*x],o=I.apply(void 0,Object(p["a"])(this.center).concat([this.zoom])),n=[i[0]-o[0],i[1]-o[1]],s=[this.halfRowCount,this.halfColCount];this.currentTileCache={};for(var a=0;a<this.rowCount;a++)for(var r=0;r<this.colCount;r++){var h=[s[0]-a,s[1]-r],c=e[0]+h[0],u=e[1]+h[1],l=n[0]+h[0]*x,d=n[1]+h[1]*x,m=c+"_"+u+"_"+this.zoom;this.currentTileCache[m]=!0,this.tileCache[m]?this.tileCache[m].updatePos(l,d).render():this.tileCache[m]=new P({ctx:this.ctx,row:c,col:u,zoom:this.zoom,x:l,y:d,shouldRender:function(e){return t.currentTileCache[e]}})}},clear:function(){this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=t.movementX*T[this.zoom],i=t.movementY*T[this.zoom],o=O.apply(void 0,Object(p["a"])(this.center)),n=Object(f["a"])(o,2),s=n[0],a=n[1];this.center=M(s-e,i+a),this.clear(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1},onMousewheel:function(t){var e=this;t.deltaY>0?this.zoom>this.minZoom&&this.zoom--:this.zoom<this.maxZoom&&this.zoom++,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=t.deltaY>0?.5:2,this.playback&&this.playback.stop(),this.playback=Object(y["a"])({from:this.scaleTmp,to:this.scale,onUpdate:function(t){e.scaleTmp=t,e.ctx.save(),e.clear(),e.ctx.scale(t,t),Object.keys(e.currentTileCache).forEach((function(t){e.tileCache[t].render()})),e.ctx.restore()},onComplete:function(){e.scale=1,e.scaleTmp=1,e.renderTiles()}}))}}},E=(i("5649"),i("6b0d")),U=i.n(E);const Y=U()(Z,[["render",m],["__scopeId","data-v-28d4dc86"]]);var B=Y,S=function(t){return Object(o["h"])("data-v-75dfd90f"),t=t(),Object(o["g"])(),t},K={class:"map",ref:"map"},N={class:"center"},X=S((function(){return Object(o["d"])("div",{class:"line lineX"},null,-1)})),$=S((function(){return Object(o["d"])("div",{class:"line lineY"},null,-1)}));function A(t,e,i,n,s,a){return Object(o["f"])(),Object(o["c"])("div",K,[Object(o["d"])("div",{class:"mapBox",ref:"mapBox",onMousedown:e[0]||(e[0]=function(){return a.onMousedown&&a.onMousedown.apply(a,arguments)})},null,544),Object(o["d"])("div",N,Object(o["j"])(this.center[0]+","+this.center[1]),1),X,$],512)}var D=i("362d"),J=function(){function t(e){var i=e.layer,o=e.row,n=e.col,s=e.zoom,a=e.x,r=e.y,h=e.shouldRender;Object(v["a"])(this,t),this.layer=i,this.row=o,this.col=n,this.zoom=s,this.x=a,this.y=r,this.shouldRender=h,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.opacity=0,this.loaded=!1,this.timer=null,this.fadeInDuration=500,this.createUrl(),this.load()}return Object(w["a"])(t,[{key:"createUrl",value:function(){this.url=R(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this,e=new Image;e.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),e.onload=function(){clearTimeout(t.timer),t.img=new D["a"].Image({image:e,width:x,height:x,opacity:t.opacity}),t.loaded=!0,t.render()}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loaded&&this.shouldRender(this.cacheKey)&&(this.layer.add(this.img),this.img.x(this.x).y(this.y),t&&0!==this.opacity&&(this.opacity=0,this.img.opacity(0)),this.fadeIn())}},{key:"fadeIn",value:function(){var t=this;if(!(this.opacity>=1)){var e=this.opacity,i=new D["a"].Animation((function(o){var n=o.time/t.fadeInDuration*1+e;t.opacity=n,t.img.opacity(n),n>=1&&i.stop()}),this.layer);i.start()}}},{key:"updateLayer",value:function(t){return this.layer=t,this}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),G={name:"App",data:function(){return{width:0,height:0,rowCount:0,colCount:0,halfRowCount:0,halfColCount:0,isMousedown:!1,tileCache:{},currentTileCache:{},center:[120.148732,30.231006],zoom:17,minZoom:3,maxZoom:18,lastZoom:0,scale:1,scaleTmp:1,playback:null,stage:null,layer1:null,layer2:null,useLayer1:!0}},mounted:function(){this.init(),this.getCount(),this.renderTiles(),window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup),window.addEventListener("wheel",this.onMousewheel)},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup),window.removeEventListener("wheel",this.onMousewheel)},methods:{init:function(){var t=this.$refs.mapBox.getBoundingClientRect(),e=t.width,i=t.height;this.width=e,this.height=i,this.stage=new D["a"].Stage({container:this.$refs.mapBox,width:e,height:i}),this.layer1=new D["a"].Layer,this.layer1.x(this.width/2).y(this.height/2),this.stage.add(this.layer1),this.layer2=new D["a"].Layer,this.layer2.x(this.width/2).y(this.height/2),this.stage.add(this.layer2)},getCount:function(){var t=2;this.rowCount=Math.ceil(this.width/x)+t,this.colCount=Math.ceil(this.height/x)+t,this.halfRowCount=Math.ceil(this.rowCount/2),this.halfColCount=Math.ceil(this.colCount/2)},renderTiles:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=_.apply(void 0,Object(p["a"])(O.apply(void 0,Object(p["a"])(this.center))).concat([this.zoom])),o=[i[0]*x,i[1]*x],n=I.apply(void 0,Object(p["a"])(this.center).concat([this.zoom])),s=[o[0]-n[0],o[1]-n[1]],a=[this.halfRowCount,this.halfColCount];this.currentTileCache={};for(var r=0;r<this.rowCount;r++)for(var h=0;h<this.colCount;h++){var c=[a[0]-r,a[1]-h],u=i[0]+c[0],l=i[1]+c[1],d=s[0]+c[0]*x,m=s[1]+c[1]*x,f=u+"_"+l+"_"+this.zoom;this.currentTileCache[f]=!0;var v=this.useLayer1?this.layer1:this.layer2;this.tileCache[f]?this.tileCache[f].updateLayer(v).updatePos(d,m).render(e):this.tileCache[f]=new J({layer:v,row:u,col:l,zoom:this.zoom,x:d,y:m,shouldRender:function(e){return t.currentTileCache[e]}})}},clearLayer:function(){this.layer1.removeChildren(),this.layer2.removeChildren()},resetLayer:function(){var t=this.useLayer1?this.layer1:this.layer2,e=this.useLayer1?this.layer2:this.layer1;e.scale({x:1,y:1}),e.removeChildren(),t.zIndex(0),e.zIndex(1)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=t.movementX*T[this.zoom],i=t.movementY*T[this.zoom],o=O.apply(void 0,Object(p["a"])(this.center)),n=Object(f["a"])(o,2),s=n[0],a=n[1];this.center=M(s-e,i+a),this.clearLayer(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1},onMousewheel:function(t){var e=this;t.deltaY>0?this.zoom>this.minZoom&&this.zoom--:this.zoom<this.maxZoom&&this.zoom++,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=t.deltaY>0?.5:2,this.playback&&this.playback.stop(),this.resetLayer(),this.playback=Object(y["a"])({from:this.scaleTmp,to:this.scale,onUpdate:function(t){e.scaleTmp=t;var i=e.useLayer1?e.layer1:e.layer2;i.scale({x:t,y:t})},onComplete:function(){e.useLayer1=!e.useLayer1,e.scale=1,e.scaleTmp=1,e.renderTiles(!0)}}))}}};i("e400");const q=U()(G,[["render",A],["__scopeId","data-v-75dfd90f"]]);var F=q,H={components:{New:F,Old:B},data:function(){return{comp:"New"}}};i("e560");const Q=U()(H,[["render",r],["__scopeId","data-v-56304d7a"]]);var V=Q;Object(o["a"])(V).mount("#app")},"5b4b":function(t,e,i){},e400:function(t,e,i){"use strict";i("5b4b")},e560:function(t,e,i){"use strict";i("fc4b")},fc4b:function(t,e,i){}});
//# sourceMappingURL=app.ed95603e.js.map