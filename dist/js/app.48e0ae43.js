(function(t){function e(e){for(var i,s,r=e[0],c=e[1],h=e[2],u=0,d=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&d.push(o[s][0]),o[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);l&&l(e);while(d.length)d.shift()();return a.push.apply(a,h||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,r=1;r<n.length;r++){var c=n[r];0!==o[c]&&(i=!1)}i&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},o={app:0},a=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="dist/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"44cc":function(t,e,n){"use strict";n("55ad")},"55ad":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("7a23"),o={class:"app"},a={class:"mapContainer"},s={class:"btnGroup"};function r(t,e,n,r,c,h){var l=this;return Object(i["g"])(),Object(i["d"])("div",o,[Object(i["e"])("div",a,[(Object(i["g"])(),Object(i["c"])(Object(i["k"])(c.comp)))]),Object(i["e"])("div",s,[Object(i["e"])("div",{class:Object(i["f"])(["btn",{active:"New"===this.comp}]),onClick:e[0]||(e[0]=function(t){return l.comp="New"})}," 优化版 ",2),Object(i["e"])("div",{class:Object(i["f"])(["btn",{active:"Old"===this.comp}]),onClick:e[1]||(e[1]=function(t){return l.comp="Old"})}," 原始版 ",2)])])}var c=function(t){return Object(i["i"])("data-v-e1a8d70c"),t=t(),Object(i["h"])(),t},h={class:"map",ref:"map"},l={class:"center"},u=c((function(){return Object(i["e"])("div",{class:"line lineX"},null,-1)})),d=c((function(){return Object(i["e"])("div",{class:"line lineY"},null,-1)}));function m(t,e,n,o,a,s){return Object(i["g"])(),Object(i["d"])("div",h,[Object(i["e"])("canvas",{ref:"canvas",onMousedown:e[0]||(e[0]=function(){return s.onMousedown&&s.onMousedown.apply(s,arguments)})},null,544),Object(i["e"])("div",l,Object(i["l"])(this.center[0]+","+this.center[1]),1),u,d],512)}for(var p=n("3835"),f=n("2909"),v=n("d4ec"),y=n("bee2"),b=(n("d81d"),n("99af"),n("d3b7"),n("159b"),n("b64b"),n("3623")),w=function(t){return t*(Math.PI/180)},O=function(t){return t*(180/Math.PI)},j=6378137,g=function(t,e){var n=w(t)*j,i=w(e),o=Math.sin(i),a=j/2*Math.log((1+o)/(1-o));return[n,a]},M=function(t,e){var n=O(t)/j,i=O(2*Math.atan(Math.exp(e/j))-Math.PI/2);return[n,i]},T=2*Math.PI*j,x=256,C=function(t){var e=Math.pow(2,t),n=e*x;return T/n},z=[],k=0;k<=18;k++)z.push(C(k));var L=function(t,e){return t+=T/2,e=T/2-e,[t,e]},I=function(t,e,n){var i=L(t,e);t=i[0],e=i[1];var o=z[n],a=Math.floor(t/o/x),s=Math.floor(e/o/x);return[a,s]},P=function(t,e,n){var i=L.apply(void 0,Object(f["a"])(g(t,e))),o=Object(p["a"])(i,2),a=o[0],s=o[1],r=z[n],c=Math.floor(a/r),h=Math.floor(s/r);return[c,h]},_=function(t,e,n){var i=[1,2,3,4],o=i[Math.floor(Math.random()*i.length)];return"https://webrd0".concat(o,".is.autonavi.com/appmaptile?x=").concat(t,"&y=").concat(e,"&z=").concat(n,"&lang=zh_cn&size=1&scale=1&style=8")},R="0913a20b5d5a703b920e1ff0d9d26559",Z=function(){function t(e){var n=e.ctx,i=e.row,o=e.col,a=e.zoom,s=e.x,r=e.y,c=e.shouldRender;Object(v["a"])(this,t),this.ctx=n,this.row=i,this.col=o,this.zoom=a,this.x=s,this.y=r,this.shouldRender=c,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.loaded=!1,this.timer=null,this.createUrl(),this.load()}return Object(y["a"])(t,[{key:"createUrl",value:function(){this.url=_(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this;this.img=new Image,this.img.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),this.img.onload=function(){clearTimeout(t.timer),t.loaded=!0,t.render()}}},{key:"render",value:function(){this.loaded&&this.shouldRender(this.cacheKey)&&this.ctx.drawImage(this.img,this.x,this.y)}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),D={name:"App",data:function(){return{width:0,height:0,isMousedown:!1,tileCache:{},currentTileCache:{},center:[120.148732,30.231006],zoom:17,minZoom:3,maxZoom:18,ctx:null,lastZoom:0,scale:1,scaleTmp:1,playback:null}},mounted:function(){this.initCanvas(),this.renderTiles(),window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup),window.addEventListener("wheel",this.onMousewheel)},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup),window.removeEventListener("wheel",this.onMousewheel)},methods:{initCanvas:function(){var t=this.$refs.map.getBoundingClientRect(),e=t.width,n=t.height;this.width=e,this.height=n;var i=this.$refs.canvas;i.width=this.width,i.height=this.height,this.ctx=i.getContext("2d"),this.ctx.translate(this.width/2,this.height/2)},renderTiles:function(){var t=this,e=I.apply(void 0,Object(f["a"])(g.apply(void 0,Object(f["a"])(this.center))).concat([this.zoom])),n=[e[0]*x,e[1]*x],i=P.apply(void 0,Object(f["a"])(this.center).concat([this.zoom])),o=[i[0]-n[0],i[1]-n[1]],a=Math.ceil((this.width/2-o[0])/x),s=Math.ceil((this.height/2-o[1])/x),r=Math.ceil((this.width/2-(x-o[0]))/x),c=Math.ceil((this.height/2-(x-o[1]))/x);this.currentTileCache={};for(var h=-a;h<=r;h++)for(var l=-s;l<=c;l++){var u=e[0]+h,d=e[1]+l,m=h*x-o[0],p=l*x-o[1],v=u+"_"+d+"_"+this.zoom;this.currentTileCache[v]=!0,this.tileCache[v]?this.tileCache[v].updatePos(m,p).render():this.tileCache[v]=new Z({ctx:this.ctx,row:u,col:d,zoom:this.zoom,x:m,y:p,shouldRender:function(e){return t.currentTileCache[e]}})}},clear:function(){this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=t.movementX*z[this.zoom],n=t.movementY*z[this.zoom],i=g.apply(void 0,Object(f["a"])(this.center)),o=Object(p["a"])(i,2),a=o[0],s=o[1];this.center=M(a-e,n+s),this.clear(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1},onMousewheel:function(t){var e=this;t.deltaY>0?this.zoom>this.minZoom&&this.zoom--:this.zoom<this.maxZoom&&this.zoom++,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=t.deltaY>0?.5:2,this.playback&&this.playback.stop(),this.playback=Object(b["a"])({from:this.scaleTmp,to:this.scale,onUpdate:function(t){e.scaleTmp=t,e.ctx.save(),e.clear(),e.ctx.scale(t,t),Object.keys(e.currentTileCache).forEach((function(t){e.tileCache[t].render()})),e.ctx.restore()},onComplete:function(){e.scale=1,e.scaleTmp=1,e.renderTiles()}}))}}},E=(n("44cc"),n("6b0d")),U=n.n(E);const B=U()(D,[["render",m],["__scopeId","data-v-e1a8d70c"]]);var S=B,N=(n("b0c0"),function(t){return Object(i["i"])("data-v-919d2e4a"),t=t(),Object(i["h"])(),t}),V={class:"map",ref:"map"},Y=N((function(){return Object(i["e"])("div",{class:"line lineX"},null,-1)})),A=N((function(){return Object(i["e"])("div",{class:"line lineY"},null,-1)})),K={class:"searchBox"},X={class:"searchInput"},$={class:"searchList"},J=["onClick"],G={class:"posInput"},q={class:"scaleBtnBox"};function F(t,e,n,o,a,s){return Object(i["g"])(),Object(i["d"])("div",V,[Object(i["e"])("div",{class:"mapBox",ref:"mapBox",onMousedown:e[0]||(e[0]=function(){return s.onMousedown&&s.onMousedown.apply(s,arguments)})},null,544),Y,A,Object(i["e"])("div",K,[Object(i["e"])("div",X,[Object(i["n"])(Object(i["e"])("input",{type:"text",placeholder:"搜索...","onUpdate:modelValue":e[1]||(e[1]=function(t){return a.searchText=t}),onInput:e[2]||(e[2]=function(){return s.onSearch&&s.onSearch.apply(s,arguments)}),onKeyup:e[3]||(e[3]=Object(i["o"])((function(){return s.onSearch&&s.onSearch.apply(s,arguments)}),["enter"])),onClick:e[4]||(e[4]=Object(i["p"])((function(){}),["stop"]))},null,544),[[i["m"],a.searchText]])]),Object(i["e"])("div",$,[(Object(i["g"])(!0),Object(i["d"])(i["a"],null,Object(i["j"])(a.searchResultList,(function(t,e){return Object(i["g"])(),Object(i["d"])("div",{class:"searchItem",key:e,onClick:function(e){return s.go(t.location)}},Object(i["l"])(t.name),9,J)})),128))])]),Object(i["e"])("div",G,[Object(i["n"])(Object(i["e"])("input",{type:"text",placeholder:"经纬度...","onUpdate:modelValue":e[5]||(e[5]=function(t){return a.posValue=t}),onKeyup:e[6]||(e[6]=Object(i["o"])((function(){return s.onChangePos&&s.onChangePos.apply(s,arguments)}),["enter"])),onClick:e[7]||(e[7]=Object(i["p"])((function(){}),["stop"]))},null,544),[[i["m"],a.posValue]])]),Object(i["e"])("div",{class:"backCenterBtn",onClick:e[8]||(e[8]=Object(i["p"])((function(){return s.backCenter&&s.backCenter.apply(s,arguments)}),["stop"]))}),Object(i["e"])("div",q,[Object(i["e"])("div",{class:Object(i["f"])(["scaleBtn in",{disabled:a.zoom>=a.maxZoom}]),onClick:e[9]||(e[9]=Object(i["p"])((function(){return s.zoomIn&&s.zoomIn.apply(s,arguments)}),["stop"]))},null,2),Object(i["e"])("div",{class:Object(i["f"])(["scaleBtn out",{disabled:a.zoom<=a.minZoom}]),onClick:e[10]||(e[10]=Object(i["p"])((function(){return s.zoomOut&&s.zoomOut.apply(s,arguments)}),["stop"]))},null,2)])],512)}var H=n("1da1"),Q=(n("96cf"),n("a15b"),n("ac1f"),n("1276"),n("a9e3"),n("498a"),n("f1ac")),W=n("362d"),tt=function(){function t(e){var n=e.layer,i=e.row,o=e.col,a=e.zoom,s=e.x,r=e.y,c=e.shouldRender;Object(v["a"])(this,t),this.layer=n,this.row=i,this.col=o,this.zoom=a,this.x=s,this.y=r,this.shouldRender=c,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.opacity=0,this.loaded=!1,this.timer=null,this.fadeInDuration=400,this.createUrl(),this.load()}return Object(y["a"])(t,[{key:"createUrl",value:function(){this.url=_(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this,e=new Image;e.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),e.onload=function(){clearTimeout(t.timer),t.img=new W["a"].Image({image:e,width:x,height:x,opacity:t.opacity}),t.loaded=!0,t.render()}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loaded&&this.img&&this.shouldRender(this.cacheKey)&&(this.layer.add(this.img),this.img.x(this.x).y(this.y),t&&0!==this.opacity&&this.hide(),this.fadeIn())}},{key:"fadeIn",value:function(){var t=this;if(!(this.opacity>=1)&&this.img){var e=this.opacity,n=new W["a"].Animation((function(i){var o=i.time/t.fadeInDuration*1+e;t.opacity=o,t.img.opacity(o),o>=1&&n.stop()}),this.layer);n.start()}}},{key:"hide",value:function(){this.img&&(this.opacity=0,this.img.opacity(0))}},{key:"updateLayer",value:function(t){return this.layer=t,this}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),et={name:"App",data:function(){return{width:0,height:0,isMousedown:!1,lastMouseTime:null,lastDuration:0,lastDistance:[],tileCache:{},currentTileCache:{},initCenter:[120.148732,30.231006],center:[120.148732,30.231006],zoom:14,minZoom:3,maxZoom:18,lastZoom:0,scale:1,scaleTmp:1,playback:null,stage:null,layer1:null,layer2:null,useLayer1:!0,searchText:"",searchTimer:null,searchResultList:[],translate:[0,0],translateTmp:[0,0],translatePlayback:null,posValue:""}},watch:{center:function(t){this.posValue=t.join(",")}},mounted:function(){var t=this;return Object(H["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.location();case 2:t.init(),t.renderTiles(),window.addEventListener("mousemove",t.onMousemove),window.addEventListener("mouseup",t.onMouseup),window.addEventListener("wheel",t.onMousewheel);case 7:case"end":return e.stop()}}),e)})))()},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup),window.removeEventListener("wheel",this.onMousewheel)},methods:{location:function(){var t=this;return Object(H["a"])(regeneratorRuntime.mark((function e(){var n,i,o,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://restapi.amap.com/v3/ip?key=".concat(R));case 3:return n=e.sent,e.next=6,n.json();case 6:i=e.sent,o=i.rectangle.split(";"),a=o[0].split(","),s=o[1].split(","),t.initCenter=t.center=[(Number(a[0])+Number(s[0]))/2,(Number(a[1])+Number(s[1]))/2],e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()},init:function(){var t=this.$refs.mapBox.getBoundingClientRect(),e=t.width,n=t.height;this.width=e,this.height=n,this.stage=new W["a"].Stage({container:this.$refs.mapBox,width:e,height:n}),this.layer1=new W["a"].Layer,this.layer1.x(this.width/2).y(this.height/2),this.stage.add(this.layer1),this.layer2=new W["a"].Layer,this.layer2.x(this.width/2).y(this.height/2),this.stage.add(this.layer2)},renderTiles:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=I.apply(void 0,Object(f["a"])(g.apply(void 0,Object(f["a"])(this.center))).concat([this.zoom])),i=[n[0]*x,n[1]*x],o=P.apply(void 0,Object(f["a"])(this.center).concat([this.zoom])),a=[o[0]-i[0],o[1]-i[1]],s=Math.ceil((this.width/2-a[0])/x),r=Math.ceil((this.height/2-a[1])/x),c=Math.ceil((this.width/2-(x-a[0]))/x),h=Math.ceil((this.height/2-(x-a[1]))/x);this.currentTileCache={};for(var l=-s;l<=c;l++)for(var u=-r;u<=h;u++){var d=n[0]+l,m=n[1]+u,p=l*x-a[0],v=u*x-a[1],y=d+"_"+m+"_"+this.zoom;this.currentTileCache[y]=!0;var b=this.getCurrentMainLayer();this.tileCache[y]?this.tileCache[y].updateLayer(b).updatePos(p,v).render(e):this.tileCache[y]=new tt({layer:b,row:d,col:m,zoom:this.zoom,x:p,y:v,shouldRender:function(e){return t.currentTileCache[e]}})}},clearLayer:function(){this.layer1.removeChildren(),this.layer2.removeChildren()},resetLayer:function(){var t=this.getCurrentMainLayer(),e=this.useLayer1?this.layer2:this.layer1;e.scale({x:1,y:1}),e.x(this.width/2).y(this.height/2),e.removeChildren(),t.zIndex(0),e.zIndex(1)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=Date.now();this.lastMouseTime&&(this.lastDuration=e-this.lastMouseTime,this.lastDistance=[t.movementX,t.movementY]),this.lastMouseTime=e;var n=t.movementX*z[this.zoom],i=t.movementY*z[this.zoom],o=g.apply(void 0,Object(f["a"])(this.center)),a=Object(p["a"])(o,2),s=a[0],r=a[1];this.center=M(s-n,i+r),this.clearLayer(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1,this.momentum()},momentum:function(){var t=this;if(this.lastDuration<=0)this.resetTranslate();else{var e=this.lastDistance[0]/this.lastDuration,n=this.lastDistance[1]/this.lastDuration;Math.abs(e)<=.3&&Math.abs(n)<=.3?this.resetTranslate():(this.translate=[e/.005,n/.005],this.resetLayer(),this.translatePlayback&&this.translatePlayback.stop(),this.translatePlayback=Object(b["a"])({from:this.translateTmp.join(" "),to:this.translate.join(" "),ease:Q["b"],onUpdate:function(e){t.translateTmp=t.stringValueToArray(e);var n=t.getCurrentMainLayer();n.x(t.width/2+t.translateTmp[0]).y(t.height/2+t.translateTmp[1])},onComplete:function(){var e=t.translate[0]*z[t.zoom],n=t.translate[1]*z[t.zoom],i=g.apply(void 0,Object(f["a"])(t.center)),o=Object(p["a"])(i,2),a=o[0],s=o[1];t.center=M(a-e,n+s),t.useLayer1=!t.useLayer1,t.resetTranslate(),t.hideTiles(),t.renderTiles()}}))}},onMousewheel:function(t){t.deltaY>0?this.zoomOut():this.zoomIn()},zoomIn:function(){this.scaleMap(!0)},zoomOut:function(){this.scaleMap(!1)},scaleMap:function(t){var e=this;t?this.zoom<this.maxZoom&&this.zoom++:this.zoom>this.minZoom&&this.zoom--,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=!t>0?.5:2,this.playback&&this.playback.stop(),this.resetLayer(),this.playback=Object(b["a"])({from:this.scaleTmp,to:this.scale,duration:500,onUpdate:function(t){e.scaleTmp=t;var n=e.getCurrentMainLayer();n.scale({x:t,y:t})},onComplete:function(){e.useLayer1=!e.useLayer1,e.scale=1,e.scaleTmp=1,e.renderTiles(!0)}}))},onSearch:function(){var t=this;clearTimeout(this.searchTimer),this.searchTimer=setTimeout((function(){t.searchText.trim()?fetch("https://restapi.amap.com/v3/assistant/inputtips?key=".concat(R,"&keywords=").concat(t.searchText.trim())).then((function(t){return t.json()})).then((function(e){t.searchResultList=e.tips||[]})):t.searchResultList=[]}),300)},go:function(t){var e=this;if(!this.translatePlayback){"string"===typeof t&&(t=t.split(",").map((function(t){return Number(t)})));var n=g.apply(void 0,Object(f["a"])(t)),i=g.apply(void 0,Object(f["a"])(this.center));this.translate=[(n[0]-i[0])/z[this.zoom],(n[1]-i[1])/z[this.zoom]],this.resetLayer(),this.translatePlayback=Object(b["a"])({from:this.translateTmp.join(" "),to:this.translate.join(" "),duration:1e3,onUpdate:function(t){e.translateTmp=e.stringValueToArray(t);var n=e.getCurrentMainLayer();n.x(e.width/2-e.translateTmp[0]).y(e.height/2+e.translateTmp[1])},onComplete:function(){e.center=t,e.useLayer1=!e.useLayer1,e.resetTranslate(),e.hideTiles(),e.renderTiles()}})}},resetTranslate:function(){this.translatePlayback=null,this.translateTmp=[0,0],this.translate=[0,0],this.lastMouseTime=null,this.lastDuration=0,this.lastDistance=[]},hideTiles:function(){var t=this;Object.keys(this.tileCache).forEach((function(e){t.currentTileCache[e]||t.tileCache[e].hide()}))},stringValueToArray:function(t){return t.split(" ").map((function(t){return Number(t)}))},getCurrentMainLayer:function(){return this.useLayer1?this.layer1:this.layer2},backCenter:function(){this.go(this.initCenter)},onChangePos:function(){this.go(this.posValue)}}};n("e7a4");const nt=U()(et,[["render",F],["__scopeId","data-v-919d2e4a"]]);var it=nt,ot={components:{New:it,Old:S},data:function(){return{comp:"New"}}};n("c64c");const at=U()(ot,[["render",r],["__scopeId","data-v-7fb52170"]]);var st=at;Object(i["b"])(st).mount("#app")},c64c:function(t,e,n){"use strict";n("e472")},cc5a:function(t,e,n){},e472:function(t,e,n){},e7a4:function(t,e,n){"use strict";n("cc5a")}});
//# sourceMappingURL=app.48e0ae43.js.map