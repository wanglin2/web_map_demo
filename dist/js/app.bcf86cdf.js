(function(t){function e(e){for(var i,a,r=e[0],c=e[1],h=e[2],u=0,d=[];u<r.length;u++)a=r[u],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&d.push(o[a][0]),o[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);l&&l(e);while(d.length)d.shift()();return s.push.apply(s,h||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,r=1;r<n.length;r++){var c=n[r];0!==o[c]&&(i=!1)}i&&(s.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},o={app:0},s=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="dist/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"1b9e":function(t,e,n){},"51dd":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("7a23"),o={class:"app"},s={class:"mapContainer"},a={class:"btnGroup"};function r(t,e,n,r,c,h){var l=this;return Object(i["g"])(),Object(i["d"])("div",o,[Object(i["e"])("div",s,[(Object(i["g"])(),Object(i["c"])(Object(i["k"])(c.comp)))]),Object(i["e"])("div",a,[Object(i["e"])("div",{class:Object(i["f"])(["btn",{active:"New"===this.comp}]),onClick:e[0]||(e[0]=function(t){return l.comp="New"})},"优化版",2),Object(i["e"])("div",{class:Object(i["f"])(["btn",{active:"Old"===this.comp}]),onClick:e[1]||(e[1]=function(t){return l.comp="Old"})},"原始版",2)])])}var c=function(t){return Object(i["i"])("data-v-b66ffc82"),t=t(),Object(i["h"])(),t},h={class:"map",ref:"map"},l={class:"center"},u=c((function(){return Object(i["e"])("div",{class:"line lineX"},null,-1)})),d=c((function(){return Object(i["e"])("div",{class:"line lineY"},null,-1)}));function m(t,e,n,o,s,a){return Object(i["g"])(),Object(i["d"])("div",h,[Object(i["e"])("canvas",{ref:"canvas",onMousedown:e[0]||(e[0]=function(){return a.onMousedown&&a.onMousedown.apply(a,arguments)})},null,544),Object(i["e"])("div",l,Object(i["l"])(this.center[0]+","+this.center[1]),1),u,d],512)}for(var f=n("3835"),p=n("2909"),v=n("d4ec"),y=n("bee2"),b=(n("d81d"),n("99af"),n("d3b7"),n("159b"),n("b64b"),n("3623")),w=function(t){return t*(Math.PI/180)},C=function(t){return t*(180/Math.PI)},j=6378137,O=function(t,e){var n=w(t)*j,i=w(e),o=Math.sin(i),s=j/2*Math.log((1+o)/(1-o));return[n,s]},g=function(t,e){var n=C(t)/j,i=C(2*Math.atan(Math.exp(e/j))-Math.PI/2);return[n,i]},x=2*Math.PI*j,M=256,k=function(t){var e=Math.pow(2,t),n=e*M;return x/n},T=[],z=0;z<=18;z++)T.push(k(z));var L=function(t,e){return t+=x/2,e=x/2-e,[t,e]},R=function(t,e,n){var i=L(t,e);t=i[0],e=i[1];var o=T[n],s=Math.floor(t/o/M),a=Math.floor(e/o/M);return[s,a]},_=function(t,e,n){var i=L.apply(void 0,Object(p["a"])(O(t,e))),o=Object(f["a"])(i,2),s=o[0],a=o[1],r=T[n],c=Math.floor(s/r),h=Math.floor(a/r);return[c,h]},I=function(t,e,n){var i=[1,2,3,4],o=i[Math.floor(Math.random()*i.length)];return"https://webrd0".concat(o,".is.autonavi.com/appmaptile?x=").concat(t,"&y=").concat(e,"&z=").concat(n,"&lang=zh_cn&size=1&scale=1&style=8")},P="0913a20b5d5a703b920e1ff0d9d26559",E=function(){function t(e){var n=e.ctx,i=e.row,o=e.col,s=e.zoom,a=e.x,r=e.y,c=e.shouldRender;Object(v["a"])(this,t),this.ctx=n,this.row=i,this.col=o,this.zoom=s,this.x=a,this.y=r,this.shouldRender=c,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.loaded=!1,this.timer=null,this.createUrl(),this.load()}return Object(y["a"])(t,[{key:"createUrl",value:function(){this.url=I(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this;this.img=new Image,this.img.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),this.img.onload=function(){clearTimeout(t.timer),t.loaded=!0,t.render()}}},{key:"render",value:function(){this.loaded&&this.shouldRender(this.cacheKey)&&this.ctx.drawImage(this.img,this.x,this.y)}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),Z={name:"App",data:function(){return{width:0,height:0,rowCount:0,colCount:0,halfRowCount:0,halfColCount:0,isMousedown:!1,tileCache:{},currentTileCache:{},center:[120.148732,30.231006],zoom:17,minZoom:3,maxZoom:18,ctx:null,lastZoom:0,scale:1,scaleTmp:1,playback:null}},mounted:function(){this.initCanvas(),this.getCount(),this.renderTiles(),window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup),window.addEventListener("wheel",this.onMousewheel)},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup),window.removeEventListener("wheel",this.onMousewheel)},methods:{initCanvas:function(){var t=this.$refs.map.getBoundingClientRect(),e=t.width,n=t.height;this.width=e,this.height=n;var i=this.$refs.canvas;i.width=this.width,i.height=this.height,this.ctx=i.getContext("2d"),this.ctx.translate(this.width/2,this.height/2)},getCount:function(){var t=4;this.rowCount=Math.ceil(this.width/M)+t,this.colCount=Math.ceil(this.height/M)+t,this.halfRowCount=Math.ceil(this.rowCount/2),this.halfColCount=Math.ceil(this.colCount/2)},renderTiles:function(){var t=this,e=R.apply(void 0,Object(p["a"])(O.apply(void 0,Object(p["a"])(this.center))).concat([this.zoom])),n=[e[0]*M,e[1]*M],i=_.apply(void 0,Object(p["a"])(this.center).concat([this.zoom])),o=[n[0]-i[0],n[1]-i[1]],s=[this.halfRowCount,this.halfColCount];this.currentTileCache={};for(var a=0;a<this.rowCount;a++)for(var r=0;r<this.colCount;r++){var c=[s[0]-a,s[1]-r],h=e[0]+c[0],l=e[1]+c[1],u=o[0]+c[0]*M,d=o[1]+c[1]*M,m=h+"_"+l+"_"+this.zoom;this.currentTileCache[m]=!0,this.tileCache[m]?this.tileCache[m].updatePos(u,d).render():this.tileCache[m]=new E({ctx:this.ctx,row:h,col:l,zoom:this.zoom,x:u,y:d,shouldRender:function(e){return t.currentTileCache[e]}})}},clear:function(){this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=t.movementX*T[this.zoom],n=t.movementY*T[this.zoom],i=O.apply(void 0,Object(p["a"])(this.center)),o=Object(f["a"])(i,2),s=o[0],a=o[1];this.center=g(s-e,n+a),this.clear(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1},onMousewheel:function(t){var e=this;t.deltaY>0?this.zoom>this.minZoom&&this.zoom--:this.zoom<this.maxZoom&&this.zoom++,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=t.deltaY>0?.5:2,this.playback&&this.playback.stop(),this.playback=Object(b["a"])({from:this.scaleTmp,to:this.scale,onUpdate:function(t){e.scaleTmp=t,e.ctx.save(),e.clear(),e.ctx.scale(t,t),Object.keys(e.currentTileCache).forEach((function(t){e.tileCache[t].render()})),e.ctx.restore()},onComplete:function(){e.scale=1,e.scaleTmp=1,e.renderTiles()}}))}}},U=(n("f0f0"),n("6b0d")),N=n.n(U);const S=N()(Z,[["render",m],["__scopeId","data-v-b66ffc82"]]);var B=S,Y=(n("b0c0"),function(t){return Object(i["i"])("data-v-726a0eb5"),t=t(),Object(i["h"])(),t}),K={class:"map",ref:"map"},X={class:"center"},$=Y((function(){return Object(i["e"])("div",{class:"line lineX"},null,-1)})),A=Y((function(){return Object(i["e"])("div",{class:"line lineY"},null,-1)})),D={class:"searchBox"},J={class:"searchInput"},G={class:"searchList"},V=["onClick"];function q(t,e,n,o,s,a){return Object(i["g"])(),Object(i["d"])("div",K,[Object(i["e"])("div",{class:"mapBox",ref:"mapBox",onMousedown:e[0]||(e[0]=function(){return a.onMousedown&&a.onMousedown.apply(a,arguments)})},null,544),Object(i["e"])("div",X,Object(i["l"])(this.center[0]+","+this.center[1]),1),$,A,Object(i["e"])("div",D,[Object(i["e"])("div",J,[Object(i["n"])(Object(i["e"])("input",{type:"text",placeholder:"搜索...","onUpdate:modelValue":e[1]||(e[1]=function(t){return s.searchText=t}),onKeyup:e[2]||(e[2]=Object(i["o"])((function(){return a.onSearch&&a.onSearch.apply(a,arguments)}),["enter"]))},null,544),[[i["m"],s.searchText]])]),Object(i["e"])("div",G,[(Object(i["g"])(!0),Object(i["d"])(i["a"],null,Object(i["j"])(s.searchResultList,(function(t,e){return Object(i["g"])(),Object(i["d"])("div",{class:"searchItem",key:e,onClick:function(e){return a.go(t.location)}},Object(i["l"])(t.name),9,V)})),128))])]),Object(i["e"])("div",{class:"backCenterBtn",onClick:e[3]||(e[3]=function(){return a.backCenter&&a.backCenter.apply(a,arguments)})})],512)}var F=n("1da1"),H=(n("ac1f"),n("1276"),n("a9e3"),n("498a"),n("a15b"),n("96cf"),n("362d")),Q=function(){function t(e){var n=e.layer,i=e.row,o=e.col,s=e.zoom,a=e.x,r=e.y,c=e.shouldRender;Object(v["a"])(this,t),this.layer=n,this.row=i,this.col=o,this.zoom=s,this.x=a,this.y=r,this.shouldRender=c,this.url="",this.cacheKey=this.row+"_"+this.col+"_"+this.zoom,this.img=null,this.opacity=0,this.loaded=!1,this.timer=null,this.fadeInDuration=500,this.createUrl(),this.load()}return Object(y["a"])(t,[{key:"createUrl",value:function(){this.url=I(this.row,this.col,this.zoom)}},{key:"load",value:function(){var t=this,e=new Image;e.src=this.url,this.timer=setTimeout((function(){t.createUrl(),t.load()}),1e3),e.onload=function(){clearTimeout(t.timer),t.img=new H["a"].Image({image:e,width:M,height:M,opacity:t.opacity}),t.loaded=!0,t.render()}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loaded&&this.shouldRender(this.cacheKey)&&(this.layer.add(this.img),this.img.x(this.x).y(this.y),t&&0!==this.opacity&&this.hide(),this.fadeIn())}},{key:"fadeIn",value:function(){var t=this;if(!(this.opacity>=1)){var e=this.opacity,n=new H["a"].Animation((function(i){var o=i.time/t.fadeInDuration*1+e;t.opacity=o,t.img.opacity(o),o>=1&&n.stop()}),this.layer);n.start()}}},{key:"hide",value:function(){this.opacity=0,this.img.opacity(0)}},{key:"updateLayer",value:function(t){return this.layer=t,this}},{key:"updatePos",value:function(t,e){return this.x=t,this.y=e,this}}]),t}(),W={name:"App",data:function(){return{width:0,height:0,rowCount:0,colCount:0,halfRowCount:0,halfColCount:0,isMousedown:!1,tileCache:{},currentTileCache:{},initCenter:[120.148732,30.231006],center:[120.148732,30.231006],zoom:14,minZoom:3,maxZoom:18,lastZoom:0,scale:1,scaleTmp:1,playback:null,stage:null,layer1:null,layer2:null,useLayer1:!0,searchText:"",searchResultList:[],translate:[0,0],translateTmp:[0,0],translatePlayback:null}},mounted:function(){var t=this;return Object(F["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.location();case 2:t.init(),t.getCount(),t.renderTiles(),window.addEventListener("mousemove",t.onMousemove),window.addEventListener("mouseup",t.onMouseup),window.addEventListener("wheel",t.onMousewheel);case 8:case"end":return e.stop()}}),e)})))()},beforeUnmount:function(){window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup),window.removeEventListener("wheel",this.onMousewheel)},methods:{location:function(){var t=this;return Object(F["a"])(regeneratorRuntime.mark((function e(){var n,i,o,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://restapi.amap.com/v3/ip?key=".concat(P));case 3:return n=e.sent,e.next=6,n.json();case 6:i=e.sent,o=i.rectangle.split(";"),s=o[0].split(","),a=o[1].split(","),t.initCenter=t.center=[(Number(s[0])+Number(a[0]))/2,(Number(s[1])+Number(a[1]))/2],e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()},init:function(){var t=this.$refs.mapBox.getBoundingClientRect(),e=t.width,n=t.height;this.width=e,this.height=n,this.stage=new H["a"].Stage({container:this.$refs.mapBox,width:e,height:n}),this.layer1=new H["a"].Layer,this.layer1.x(this.width/2).y(this.height/2),this.stage.add(this.layer1),this.layer2=new H["a"].Layer,this.layer2.x(this.width/2).y(this.height/2),this.stage.add(this.layer2)},getCount:function(){var t=4;this.rowCount=Math.ceil(this.width/M)+t,this.colCount=Math.ceil(this.height/M)+t,this.halfRowCount=Math.ceil(this.rowCount/2),this.halfColCount=Math.ceil(this.colCount/2)},renderTiles:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=R.apply(void 0,Object(p["a"])(O.apply(void 0,Object(p["a"])(this.center))).concat([this.zoom])),i=[n[0]*M,n[1]*M],o=_.apply(void 0,Object(p["a"])(this.center).concat([this.zoom])),s=[i[0]-o[0],i[1]-o[1]],a=[this.halfRowCount,this.halfColCount];this.currentTileCache={};for(var r=0;r<this.rowCount;r++)for(var c=0;c<this.colCount;c++){var h=[a[0]-r,a[1]-c],l=n[0]+h[0],u=n[1]+h[1],d=s[0]+h[0]*M,m=s[1]+h[1]*M,f=l+"_"+u+"_"+this.zoom;this.currentTileCache[f]=!0;var v=this.useLayer1?this.layer1:this.layer2;this.tileCache[f]?this.tileCache[f].updateLayer(v).updatePos(d,m).render(e):this.tileCache[f]=new Q({layer:v,row:l,col:u,zoom:this.zoom,x:d,y:m,shouldRender:function(e){return t.currentTileCache[e]}})}},clearLayer:function(){this.layer1.removeChildren(),this.layer2.removeChildren()},resetLayer:function(){var t=this.useLayer1?this.layer1:this.layer2,e=this.useLayer1?this.layer2:this.layer1;e.scale({x:1,y:1}),e.x(this.width/2).y(this.height/2),e.removeChildren(),t.zIndex(0),e.zIndex(1)},onMousedown:function(t){1===t.which&&(this.isMousedown=!0)},onMousemove:function(t){if(this.isMousedown){var e=t.movementX*T[this.zoom],n=t.movementY*T[this.zoom],i=O.apply(void 0,Object(p["a"])(this.center)),o=Object(f["a"])(i,2),s=o[0],a=o[1];this.center=g(s-e,n+a),this.clearLayer(),this.renderTiles()}},onMouseup:function(){this.isMousedown=!1},onMousewheel:function(t){var e=this;t.deltaY>0?this.zoom>this.minZoom&&this.zoom--:this.zoom<this.maxZoom&&this.zoom++,this.lastZoom!==this.zoom&&(this.lastZoom=this.zoom,this.scale*=t.deltaY>0?.5:2,this.playback&&this.playback.stop(),this.resetLayer(),this.playback=Object(b["a"])({from:this.scaleTmp,to:this.scale,onUpdate:function(t){e.scaleTmp=t;var n=e.useLayer1?e.layer1:e.layer2;n.scale({x:t,y:t})},onComplete:function(){e.useLayer1=!e.useLayer1,e.scale=1,e.scaleTmp=1,e.renderTiles(!0)}}))},onSearch:function(){var t=this;this.searchText.trim()&&fetch("https://restapi.amap.com/v3/assistant/inputtips?key=".concat(P,"&keywords=").concat(this.searchText.trim())).then((function(t){return t.json()})).then((function(e){t.searchResultList=e.tips||[]}))},go:function(t){var e=this;if(!this.translatePlayback){"string"===typeof t&&(t=t.split(",").map((function(t){return Number(t)})));var n=O.apply(void 0,Object(p["a"])(t)),i=O.apply(void 0,Object(p["a"])(this.center));this.translate=[(n[0]-i[0])/T[this.zoom],(n[1]-i[1])/T[this.zoom]],this.resetLayer(),this.translatePlayback=Object(b["a"])({from:this.translateTmp.join(" "),to:this.translate.join(" "),duration:1e3,onUpdate:function(t){e.translateTmp=t.split(" ").map((function(t){return Number(t)}));var n=e.useLayer1?e.layer1:e.layer2;n.x(e.width/2-e.translateTmp[0]).y(e.translateTmp[1]+e.height/2)},onComplete:function(){e.translatePlayback=null,e.center=t,e.useLayer1=!e.useLayer1,e.translateTmp=[0,0],e.translate=[0,0],Object.keys(e.tileCache).forEach((function(t){e.currentTileCache[t]||e.tileCache[t].hide()})),e.renderTiles()}})}},backCenter:function(){this.go(this.initCenter)}}};n("a79b");const tt=N()(W,[["render",q],["__scopeId","data-v-726a0eb5"]]);var et=tt,nt={components:{New:et,Old:B},data:function(){return{comp:"New"}}};n("e560");const it=N()(nt,[["render",r],["__scopeId","data-v-56304d7a"]]);var ot=it;Object(i["b"])(ot).mount("#app")},a79b:function(t,e,n){"use strict";n("1b9e")},e560:function(t,e,n){"use strict";n("fc4b")},f0f0:function(t,e,n){"use strict";n("51dd")},fc4b:function(t,e,n){}});
//# sourceMappingURL=app.bcf86cdf.js.map